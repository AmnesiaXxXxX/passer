PRAGMA foreign_keys=OFF;
BEGIN TRANSACTION;
CREATE TABLE registrations (
    date TEXT PRIMARY KEY,           -- Дата события в формате YYYY-MM-DD
    visitors_count INTEGER DEFAULT 0,-- Количество зарегистрированных посетителей
    max_visitors INTEGER             -- Максимальное количество посетителей
);
INSERT INTO registrations VALUES('2025-04-19',8,50);
CREATE TABLE visitors (
    tg_id INTEGER,                   -- ID пользователя в Telegram
    to_datetime TEXT,                -- Дата записи (без времени) в формате YYYY-MM-DD
    hash_code TEXT,                  -- Хэш-код записи
    is_active INTEGER DEFAULT 1,     -- 1 - активен, 0 - неактивен
    FOREIGN KEY (to_datetime) REFERENCES registrations(date) -- Связь с таблицей событий
);
INSERT INTO visitors VALUES(1234,'2025-09-19','de3ab422a87489f343a9e090807e8adaf4866f1e1c704f76c95adf5f337b51b7',1);
INSERT INTO visitors VALUES(1249175269,'2025-04-19','17fae5d82d483d086f773efd35f5a0ff213f24e6e8a1bfb5bf500f6ff39a1403',1);
INSERT INTO visitors VALUES(1355279779,'2025-04-19','1383a970423decddc80264784f475635fcf3f5c82f7d9bf990e1f176c93dcbe9',0);
INSERT INTO visitors VALUES(8189089800,'2025-04-19','353a33834964d0aa676a7f0358c9711e1d501298ffb018e8f2d40cc9a7ed17cc',1);
INSERT INTO visitors VALUES(1809091797,'2025-04-19','128343efb8286662cd2179035830959c4da164c3e28cd85730a5da3f87d6b247',0);
INSERT INTO visitors VALUES(1568916887,'2025-04-19','8383d442a2e85972a210c0cb8b8e92251a823d3e35ddf997569f64fa6b412491',1);
INSERT INTO visitors VALUES(6302296377,'2025-04-19','0b3999a32b843905bfd5e64495e5eac015aad4141ef3897e67473a637d5b6e41',1);
INSERT INTO visitors VALUES(6755197888,'2025-04-19','0321dded05a0fbb67f30475a75ad646af5c6eec21d0101f73aa1fe3a680a3083',0);
INSERT INTO visitors VALUES(7222942631,'2025-04-19','ed11386cfacaf92bcd5ca500c778fe9dea0997279bb1bbc9e102d96f7119bd12',0);
INSERT INTO visitors VALUES(1199915569,'2025-04-19','06dee44307faedd6e81fa088c24b58134c2595c41de5b0a469e251e9e57f708e',0);
INSERT INTO visitors VALUES(6864286604,'2025-04-19','7c1042c68b61595884d33fd3c765376d1a9ab9325e5972c6f65016b263693256',1);
INSERT INTO visitors VALUES(7218825228,'2025-04-19','450e2ba048af3bec0241cd9ae5a6f58ad233cb9de185c1e343438747a90ba150',0);
INSERT INTO visitors VALUES(6964543359,'2025-04-19','3c6b1ae4c2653915a416e45fe1157966925240a65ccacb0edef076cc1f4e46fe',0);
INSERT INTO visitors VALUES(1641062164,'2025-04-19','45fdad72f99acb80b4049d961974f38ba5261c9a5f9efabdfe634b1f64504d08',1);
INSERT INTO visitors VALUES(1319231256,'2025-04-19','b6b228aaa8ee8fa510ab476119406ed16b71460490315f58575af2392be158ed',0);
INSERT INTO visitors VALUES(5866396687,'2025-04-19','fd122aa5ea39de17943c0a5d868c430fedb38642ab40d5a4f22c011a62a6cf1c',0);
INSERT INTO visitors VALUES(1676553964,'2025-04-19','f5a52538fe59f094c76493c4a7829f7257bd1d76d2b60ea475aae2e742e36c25',0);
INSERT INTO visitors VALUES(1738728377,'2025-04-19','0b90183096e88bb977d261790892d160300a004f196d3a80c453e8ef4d6cac7c',0);
INSERT INTO visitors VALUES(1600187166,'2025-04-19','1fbe2f1b85f5604dc46704a452e9d1bf5ebcdcb01b0ccc1f22d78f213fe13756',0);
INSERT INTO visitors VALUES(1018786948,'2025-04-19','67bf0d5efb878d197dd890c48b49090958ef09726a063eb12aa39ac6036112c1',1);
INSERT INTO visitors VALUES(1951011954,'2025-04-19','9076fc650b5841c2a7e9fe1a50fbad654ef6a9787f40919e7e44b945c85afc63',1);
CREATE TABLE users (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            tg_id TEXT NOT NULL
        );
INSERT INTO users VALUES(2,'1456226716');
INSERT INTO users VALUES(3,'1319231256');
INSERT INTO users VALUES(4,'1500775293');
INSERT INTO users VALUES(5,'5067249706');
INSERT INTO users VALUES(6,'915137716');
INSERT INTO users VALUES(7,'1485314920');
INSERT INTO users VALUES(8,'5728784645');
INSERT INTO users VALUES(9,'1001909024');
INSERT INTO users VALUES(10,'2053382405');
INSERT INTO users VALUES(11,'5979502914');
INSERT INTO users VALUES(12,'6292509236');
INSERT INTO users VALUES(13,'2134217258');
INSERT INTO users VALUES(14,'1571258204');
INSERT INTO users VALUES(15,'7209131788');
INSERT INTO users VALUES(16,'5723624645');
INSERT INTO users VALUES(17,'5166505841');
INSERT INTO users VALUES(18,'5627737885');
INSERT INTO users VALUES(19,'7962180290');
INSERT INTO users VALUES(20,'6358507519');
INSERT INTO users VALUES(21,'6343312839');
INSERT INTO users VALUES(22,'6396890239');
INSERT INTO users VALUES(23,'6066333488');
INSERT INTO users VALUES(24,'6604955188');
INSERT INTO users VALUES(25,'7244827138');
INSERT INTO users VALUES(26,'5643585549');
INSERT INTO users VALUES(27,'1418695697');
INSERT INTO users VALUES(28,'5107373574');
INSERT INTO users VALUES(29,'1372874950');
INSERT INTO users VALUES(30,'729378919');
INSERT INTO users VALUES(31,'1629280947');
INSERT INTO users VALUES(32,'5204545489');
INSERT INTO users VALUES(33,'1603484889');
INSERT INTO users VALUES(34,'8023288852');
INSERT INTO users VALUES(35,'5957115070');
INSERT INTO users VALUES(36,'7691445477');
INSERT INTO users VALUES(37,'5290585748');
INSERT INTO users VALUES(38,'911231385');
INSERT INTO users VALUES(39,'5221053307');
INSERT INTO users VALUES(40,'5529919324');
INSERT INTO users VALUES(41,'8150920526');
INSERT INTO users VALUES(42,'831985431');
INSERT INTO users VALUES(43,'7698072631');
INSERT INTO users VALUES(44,'1600187166');
INSERT INTO users VALUES(45,'1056259367');
INSERT INTO users VALUES(46,'1417158518');
INSERT INTO users VALUES(47,'1242582104');
INSERT INTO users VALUES(48,'6798122574');
INSERT INTO users VALUES(49,'6068024672');
INSERT INTO users VALUES(50,'1479250097');
INSERT INTO users VALUES(51,'6793538514');
INSERT INTO users VALUES(52,'5625469875');
INSERT INTO users VALUES(53,'1892499438');
INSERT INTO users VALUES(54,'7549092341');
INSERT INTO users VALUES(55,'8109602855');
INSERT INTO users VALUES(56,'5043245723');
INSERT INTO users VALUES(57,'6755197888');
INSERT INTO users VALUES(58,'5500124566');
INSERT INTO users VALUES(59,'1741784948');
INSERT INTO users VALUES(60,'1335176162');
INSERT INTO users VALUES(61,'1249175269');
INSERT INTO users VALUES(62,'1357806785');
INSERT INTO users VALUES(63,'5171585471');
INSERT INTO users VALUES(64,'1642350129');
INSERT INTO users VALUES(65,'6300656299');
INSERT INTO users VALUES(66,'2046427489');
INSERT INTO users VALUES(67,'1836479702');
INSERT INTO users VALUES(68,'6393874239');
INSERT INTO users VALUES(69,'6082449434');
INSERT INTO users VALUES(70,'5560649005');
INSERT INTO users VALUES(71,'1427466603');
INSERT INTO users VALUES(72,'1483109696');
INSERT INTO users VALUES(73,'2053886955');
INSERT INTO users VALUES(74,'7667167040');
INSERT INTO users VALUES(75,'5094558149');
INSERT INTO users VALUES(76,'1434045018');
INSERT INTO users VALUES(77,'6447032726');
INSERT INTO users VALUES(78,'5504529299');
INSERT INTO users VALUES(79,'1351876988');
INSERT INTO users VALUES(80,'7400524722');
INSERT INTO users VALUES(81,'1301489938');
INSERT INTO users VALUES(82,'7753357781');
INSERT INTO users VALUES(83,'5095189919');
INSERT INTO users VALUES(84,'5755969597');
INSERT INTO users VALUES(85,'2107806918');
INSERT INTO users VALUES(86,'1610965585');
INSERT INTO users VALUES(87,'5624384301');
INSERT INTO users VALUES(88,'5011017793');
INSERT INTO users VALUES(89,'6391561957');
INSERT INTO users VALUES(90,'5004951975');
INSERT INTO users VALUES(91,'7320357773');
INSERT INTO users VALUES(92,'6805351829');
INSERT INTO users VALUES(93,'7846593492');
INSERT INTO users VALUES(94,'1458984015');
INSERT INTO users VALUES(95,'1478508784');
INSERT INTO users VALUES(96,'5333288484');
INSERT INTO users VALUES(97,'7473192642');
INSERT INTO users VALUES(98,'8189089800');
INSERT INTO users VALUES(99,'7732420194');
INSERT INTO users VALUES(100,'6407105122');
INSERT INTO users VALUES(101,'1181869809');
INSERT INTO users VALUES(102,'5068228946');
INSERT INTO users VALUES(103,'7884270261');
INSERT INTO users VALUES(104,'1456139619');
INSERT INTO users VALUES(105,'1442256052');
INSERT INTO users VALUES(106,'1987863220');
INSERT INTO users VALUES(107,'5866396687');
INSERT INTO users VALUES(108,'7412500722');
INSERT INTO users VALUES(109,'1818916806');
INSERT INTO users VALUES(110,'7222942631');
INSERT INTO users VALUES(111,'5286095739');
INSERT INTO users VALUES(112,'6333421844');
INSERT INTO users VALUES(113,'5061939821');
INSERT INTO users VALUES(114,'1907542369');
INSERT INTO users VALUES(115,'7995142200');
INSERT INTO users VALUES(116,'5787907618');
INSERT INTO users VALUES(117,'6236786521');
INSERT INTO users VALUES(118,'1779014445');
INSERT INTO users VALUES(119,'6527199742');
INSERT INTO users VALUES(120,'1272674880');
INSERT INTO users VALUES(121,'1767052705');
INSERT INTO users VALUES(122,'2131132811');
INSERT INTO users VALUES(123,'6551149437');
INSERT INTO users VALUES(124,'1575873779');
INSERT INTO users VALUES(125,'6553530782');
INSERT INTO users VALUES(126,'6318657853');
INSERT INTO users VALUES(127,'1461125440');
INSERT INTO users VALUES(128,'6302296377');
INSERT INTO users VALUES(129,'5576957935');
INSERT INTO users VALUES(130,'1479679612');
INSERT INTO users VALUES(131,'1415821892');
INSERT INTO users VALUES(132,'1989765916');
INSERT INTO users VALUES(133,'1945313538');
INSERT INTO users VALUES(134,'1854781162');
INSERT INTO users VALUES(135,'5797144957');
INSERT INTO users VALUES(136,'1952855525');
INSERT INTO users VALUES(137,'7406117641');
INSERT INTO users VALUES(138,'1382699095');
INSERT INTO users VALUES(139,'1203428280');
INSERT INTO users VALUES(140,'1018786948');
INSERT INTO users VALUES(141,'5397983085');
INSERT INTO users VALUES(142,'7475956142');
INSERT INTO users VALUES(143,'7343074693');
INSERT INTO users VALUES(144,'1690343124');
INSERT INTO users VALUES(145,'1620385430');
INSERT INTO users VALUES(146,'1329774550');
INSERT INTO users VALUES(147,'7014666986');
INSERT INTO users VALUES(148,'1233565739');
INSERT INTO users VALUES(149,'5214367768');
INSERT INTO users VALUES(150,'5540868717');
INSERT INTO users VALUES(151,'5932318086');
INSERT INTO users VALUES(152,'1577561679');
INSERT INTO users VALUES(153,'1886468345');
INSERT INTO users VALUES(154,'1021059361');
INSERT INTO users VALUES(155,'7332283321');
INSERT INTO users VALUES(156,'2119598766');
INSERT INTO users VALUES(157,'6344631878');
INSERT INTO users VALUES(158,'1577418985');
INSERT INTO users VALUES(159,'1267070458');
INSERT INTO users VALUES(160,'5181734315');
INSERT INTO users VALUES(161,'7950054567');
INSERT INTO users VALUES(162,'1854647012');
INSERT INTO users VALUES(163,'7698627770');
INSERT INTO users VALUES(164,'7402885949');
INSERT INTO users VALUES(165,'5059462324');
INSERT INTO users VALUES(166,'6583515382');
INSERT INTO users VALUES(167,'1951011954');
INSERT INTO users VALUES(168,'6771935045');
INSERT INTO users VALUES(169,'866747682');
INSERT INTO users VALUES(170,'1681492229');
INSERT INTO users VALUES(171,'6332674353');
INSERT INTO users VALUES(172,'1428014391');
INSERT INTO users VALUES(173,'6365555715');
INSERT INTO users VALUES(174,'1199915569');
INSERT INTO users VALUES(175,'1361356250');
INSERT INTO users VALUES(176,'1185823076');
INSERT INTO users VALUES(177,'7834256739');
INSERT INTO users VALUES(178,'1404002731');
INSERT INTO users VALUES(179,'5041078455');
INSERT INTO users VALUES(180,'7868493048');
INSERT INTO users VALUES(181,'1355279779');
INSERT INTO users VALUES(182,'7675738506');
INSERT INTO users VALUES(183,'5859996360');
INSERT INTO users VALUES(184,'1973042138');
INSERT INTO users VALUES(185,'7774286722');
INSERT INTO users VALUES(186,'1568916887');
INSERT INTO users VALUES(187,'1738728377');
INSERT INTO users VALUES(188,'6774444279');
INSERT INTO users VALUES(189,'1216368814');
INSERT INTO users VALUES(190,'6672069795');
INSERT INTO users VALUES(191,'1641062164');
INSERT INTO users VALUES(192,'6864286604');
INSERT INTO users VALUES(193,'807987966');
INSERT INTO users VALUES(194,'6341842668');
INSERT INTO users VALUES(195,'5660337217');
INSERT INTO users VALUES(196,'1410064593');
INSERT INTO users VALUES(197,'1809091797');
INSERT INTO users VALUES(198,'6429662995');
INSERT INTO users VALUES(199,'7161852373');
INSERT INTO users VALUES(200,'6791264678');
INSERT INTO users VALUES(201,'1917093044');
INSERT INTO users VALUES(202,'1131448434');
INSERT INTO users VALUES(203,'7663251759');
INSERT INTO users VALUES(204,'7992168996');
INSERT INTO users VALUES(205,'1923711760');
INSERT INTO users VALUES(206,'1389669500');
INSERT INTO users VALUES(207,'1623575252');
INSERT INTO users VALUES(208,'2063026779');
INSERT INTO users VALUES(209,'6131657760');
INSERT INTO users VALUES(210,'1054517147');
INSERT INTO users VALUES(211,'7218825228');
INSERT INTO users VALUES(212,'6954164905');
INSERT INTO users VALUES(213,'5267191029');
INSERT INTO users VALUES(214,'6964543359');
INSERT INTO users VALUES(215,'5341022103');
INSERT INTO users VALUES(216,'1216619428');
INSERT INTO users VALUES(217,'6701503689');
INSERT INTO users VALUES(218,'1489361257');
INSERT INTO users VALUES(219,'1374220969');
INSERT INTO users VALUES(220,'1676553964');
INSERT INTO users VALUES(221,'1715996431');
INSERT INTO users VALUES(222,'6207507591');
INSERT INTO users VALUES(223,'920764388');
INSERT INTO users VALUES(224,'6004614222');
INSERT INTO users VALUES(225,'1527074393');
INSERT INTO users VALUES(226,'739311033');
DELETE FROM sqlite_sequence;
INSERT INTO sqlite_sequence VALUES('users',226);
CREATE TRIGGER update_visitors_count_delete
AFTER DELETE ON visitors
FOR EACH ROW
BEGIN
    UPDATE registrations
    SET visitors_count = (
        SELECT COUNT(*)
        FROM visitors
        WHERE to_datetime = OLD.to_datetime
          AND is_active = 1
    )
    WHERE date = OLD.to_datetime;
END;
CREATE TRIGGER update_visitors_count_update
AFTER UPDATE ON visitors
FOR EACH ROW
BEGIN
    -- Обновляем счетчик для старой даты (если дата изменилась)
    UPDATE registrations
    SET visitors_count = (
        SELECT COUNT(*)
        FROM visitors
        WHERE to_datetime = OLD.to_datetime
          AND is_active = 1
    )
    WHERE date = OLD.to_datetime;

    -- Обновляем счетчик для новой даты
    UPDATE registrations
    SET visitors_count = (
        SELECT COUNT(*)
        FROM visitors
        WHERE to_datetime = NEW.to_datetime
          AND is_active = 1
    )
    WHERE date = NEW.to_datetime;
END
;
CREATE TRIGGER update_visitors_count_insert
AFTER INSERT ON visitors
FOR EACH ROW
BEGIN
    UPDATE registrations
    SET visitors_count = (
        SELECT COUNT(*)
        FROM visitors
        WHERE to_datetime = NEW.to_datetime
          AND is_active = 1
    )
    WHERE date = NEW.to_datetime;
END;
COMMIT;
